name: Label Pull Requests

on:
  pull_request:
    types:
      - opened
      - reopened

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Set GitHub context
        uses: actions/github-script@v5
        with:
          script: |
            const context = JSON.stringify(github.context);
            console.log(`::set-env name=GITHUB_CONTEXT::${context}`);
            
      - name: Apply kind label to PR
        uses: actions/github-script@v5
        with:
          script: |
            const githubContext = process.env.GITHUB_CONTEXT ? JSON.parse(process.env.GITHUB_CONTEXT) : null;
            if (githubContext) {
              const prLabels = githubContext.payload.pull_request.labels.map(label => label.name);
              let kindLabel;
              if (prLabels.includes('/kind breaking')) {
                kindLabel = 'kind/breaking';
              } else if (prLabels.includes('/kind bug')) {
                kindLabel = 'kind/bug';
              } else if (prLabels.includes('/kind cleanup')) {
                kindLabel = 'kind/cleanup';
              } else if (prLabels.includes('/kind documentation')) {
                kindLabel = 'kind/documentation';
              } else if (prLabels.includes('/kind feature')) {
                kindLabel = 'kind/feature';
              } else if (prLabels.includes('/kind hotfix')) {
                kindLabel = 'kind/hotfix';
              }

              if (kindLabel) {
                githubContext.issues.addLabels({
                  owner: githubContext.repo.owner,
                  repo: githubContext.repo.repo,
                  issue_number: githubContext.payload.pull_request.number,
                  labels: [kindLabel]
                });
              }
            } else {
              console.log("GITHUB_CONTEXT is null or undefined");
            }
        env:
          GITHUB_TOKEN: ${{ secrets.AGONES_BOT }}
